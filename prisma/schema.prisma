generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      String   @default("staff")
  createdAt DateTime @default(now())
}

model Business {
  id                  Int     @id @default(autoincrement())
  name                String
  address             String
  location            String
  GSTIN               String
  PrimaryContactName  String
  PrimaryContactPhone String
  brands              Brand[]
}

model Brand {
  id          Int          @id @default(autoincrement())
  name        String
  businessId  Int
  business    Business     @relation(fields: [businessId], references: [id])
  restaurants Restaurant[]
}

model Restaurant {
  id                     Int                     @id @default(autoincrement())
  name                   String
  address                String
  location               String
  GSTIN                  String
  FSSAI                  String
  PrimaryContactName     String
  PrimaryContactPhone    String
  brandId                Int
  brand                  Brand                   @relation(fields: [brandId], references: [id])
  restaurantPricingPlans RestaurantPricingPlan[]
  invoices               Invoice[]
}

model RestaurantPricingPlan {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  restaurantId Int
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id])

  pricingPlanId Int
  pricingPlan   PricingPlan @relation(fields: [pricingPlanId], references: [id])

  cgst      Boolean  @default(false)
  sgst      Boolean  @default(false)
  igst      Boolean  @default(false)
  addLut    Boolean  @default(false)
  startDate DateTime @default(now())
  planMode  String
  trialDays Int?

  @@unique([restaurantId, pricingPlanId])
}

model Invoice {
  id                Int            @id @default(autoincrement())
  createdAt         DateTime       @default(now())

  restaurantId      Int
  restaurant        Restaurant     @relation(fields: [restaurantId], references: [id])

  pricingPlanId     Int
  pricingPlan       PricingPlan    @relation(fields: [pricingPlanId], references: [id])

  subTotalAmount    Float?
  totalAmount       Float
  dueDate           DateTime
  proformaNumber    String?
  invoiceNumber     String?        @unique
  paymentDate       DateTime?
  paymentNotes      String?
  isPartialPayment  Boolean        @default(false)
  paymentFile       String?

  status            String         @default("pending")
}

model PricingPlan {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  planType               String
  planName               String                  @unique
  description            String?
  fixedPrice             Float?
  basePrice              Float
  creditsIncluded        Float
  validity               Float?
  meteredProducts        MeteredProduct[]
  includedProducts       IncludedProduct[]
  restaurantPricingPlans RestaurantPricingPlan[]
  invoices               Invoice[]
}

model Product {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  name             String            @unique
  meteredProducts  MeteredProduct[]
  includedProducts IncludedProduct[]
}

model MeteredProduct {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  planId Int
  plan   PricingPlan @relation(fields: [planId], references: [id])

  productId Int
  product   Product @relation(fields: [productId], references: [id])

  credits  Float
  isActive Boolean @default(true)

  @@unique([planId, productId])
}

model IncludedProduct {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  planId Int
  plan   PricingPlan @relation(fields: [planId], references: [id])

  productId Int
  product   Product @relation(fields: [productId], references: [id])

  credits  Float
  isActive Boolean @default(true)

  @@unique([planId, productId])
}
